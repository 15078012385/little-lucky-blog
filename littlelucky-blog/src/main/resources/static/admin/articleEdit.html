<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
          integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <link rel="shortcut icon" href="/img/icon.png" type="image/x-icon"/>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"
            integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd"
            crossorigin="anonymous"></script>

    <!--    流光字样式-->
    <style type="text/css">
        .jumbotron {
            border-radius: 5px;
        }

        body {
            width: 100%;
            height: 100%;
            background: url(../img/background2.jpg) fixed;
            background-size: 100%;
        }

        h2 {
            margin: 0;
            background: -webkit-linear-gradient(left,
            #ffffff,
            #ff0000 6.25%,
            #ff7d00 12.5%,
            #ffff00 18.75%,
            #00ff00 25%,
            #00ffff 31.25%,
            #0000ff 37.5%,
            #ff00ff 43.75%,
            #ffff00 50%,
            #ff0000 56.25%,
            #ff7d00 62.5%,
            #ffff00 68.75%,
            #00ff00 75%,
            #00ffff 81.25%,
            #0000ff 87.5%,
            #ff00ff 93.75%,
            #ffff00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 100%;
            animation: masked-animation 5s infinite linear;
        }

        @keyframes masked-animation {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: -100%, 0;
            }
        }
    </style>

    <style type="text/css">
        small {
            font-size: 14px;
            color: #aaa;
        }

        pre {
            padding: 5px;
            background-color: #eee;
        }

        .textcenter {
            text-align: center;
        }
    </style>


</head>

<body>

<!--导航-->
<div class="container-fluid" style="background-color:#d1ccc0;opacity:0.8;height: 60px;line-height: 50px;">

    <div class="row">
        <div class="col-md-1 col-lg-offset-1">
            <!--                <img src="../img/logo.png"-->
            <!--                     style="height: 50px; border-radius: 10px;margin-top: 5px;">-->
        </div>

        <div class="col-md-1 col-md-offset-1">
            <a href="articleManagement.html">
                <button type="button" class="btn btn-info">
                        <span class="
                            glyphicon glyphicon-tags" aria-hidden="true"></span>
                    文章管理
                </button>
            </a>


        </div>

        <div class="col-md-1">
            <a href="categoryManagement.html">

                <button type="button" class="btn btn-info ">
                    <span class=" glyphicon glyphicon-tags"></span>
                    分类管理
                </button>

            </a>

        </div>

        <div class="col-md-1">
            <a href="timelineManagement.html">
                <el-button type="primary" plain></el-button>
                <button type="button" class="btn btn-info ">
                    <span class="glyphicon glyphicon-time"></span>
                    时轴管理
                </button>
            </a>

        </div>

        <div class="col-md-1">
            <a href="imgManagement.html">
                <el-button type="primary" plain></el-button>
                <button type="button" class="btn btn-info ">
                    <span class="glyphicon glyphicon-time"></span>
                    照片管理
                </button>
            </a>
        </div>

        <div class="col-md-1">
            <a href="messageManagement.html">
                <button type="button" class="btn btn-info ">
                    <span class="glyphicon glyphicon-envelope"></span>
                    留言管理
                </button>
            </a>

        </div>


        <div class="col-md-1">
            <button type="button" id="logout" class="btn btn-info ">
                注销
            </button>
        </div>

    </div>


</div>

<!--富文本-->
<div style="width: 60%;margin: 0 auto;margin-top: 5%">
    <form>
        <input type="text" class="form-control" placeholder="ID" name="id" id="id" hidden style="display: none">
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon1" style="color: lightseagreen">标题</span>
            <input type="text" class="form-control" placeholder="标题" name="title" id="title">
        </div>

        <br>
        <textarea id="editor" name="content" rows="5" style="display: none;"></textarea>
        <br>

        <div class="input-group" style="float: left;width: 49%">
            <span class="input-group-addon" style="color: lightseagreen">分类</span>
            <input type="text" class="form-control" name="category" id="category" placeholder="分类">
        </div>


        <div class="input-group " style="float: right;width: 49%">
            <span class="input-group-addon" style="color: lightseagreen">首图</span>
            <input type="text" class="form-control" name="firstImg" id="firstImg" placeholder="首图地址...">
        </div>

        <textarea style="resize: none;width: 100%;height: 150px;border-radius: 5px;margin-top: 2%"
                  placeholder="博客描述..." name="description" id="description"></textarea>
        <br>
        <br>

        <div style="display: inline-block;float: right">
            <button type="button" class="btn btn-danger" id="return">返回</button>
            <button type="button" class="btn btn-success" id="publish">修改</button>
        </div>

    </form>

</div>


<!--页脚-->
<div class="jumbotron" style="height:auto; text-align: center;background-color:#d1ccc0;opacity:0.8;margin-top: 4%">

    <div class="row">
        <div class="col-md-4">
            <h2>联系我</h2>
            <br> QQ：<a>321395678</a>
        </div>
        <div class="col-md-4"><img src="../img/wechat.jpg" width="150px"></div>
        <div class="col-md-4">
            <h2>LUCKY-SIX</h2>
            这是我的个人博客,<br>我会在这里分享我的学习历程。
        </div>
    </div>

    <br>
    <font style="color:black"><a style="text-decoration: none">Copyright © 2022 - 2022 小幸运 Designed by
        CHEN</a></font>
    <br>
    <font style="color:black"><a style="text-decoration: none"> <img src="/img/备案图标.png">备案号：桂ICP备2022006569号-1</a></font>
</div>


</body>
<!--jquery，发ajax-->
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<!--富文本js-->
<script src="../HandyEditor.min.js"></script>
<script type="text/javascript" src="../js/popMessage.js"></script>

<script type="text/javascript">
    //    编辑器
    var he = HE.getEditor('editor', {
        width: '100%',
        height: '300px',
        autoHeight: true,
        autoFloat: false,
        topOffset: 0,
        uploadPhoto: true,
        uploadPhotoHandler: '/admin/file/upload',
        uploadPhotoSize: 0,
        uploadPhotoType: 'gif,png,jpg,jpeg',
        uploadPhotoSizeError: '不能上传大于××KB的图片',
        uploadPhotoTypeError: '只能上传gif,png,jpg,jpeg格式的图片',
        uploadParam: {},
        lang: 'zh-jian',
        skin: 'HandyEditor',
        externalSkin: '',
        item: ['bold', 'italic', 'strike', 'underline', 'fontSize', 'fontName', 'paragraph', 'color', 'backColor', '|', 'center', 'left', 'right', 'full', 'indent', 'outdent', '|', 'link', 'unlink', 'textBlock', 'code', 'trash', '|', 'image', 'expression', 'unorderedList', '|', 'undo', 'redo', '|', 'html']
    });

    $("#return").click(function () {
        window.open("articleManagement.html", "_self")
    })


    var id = getUrlParam('id');
    if (id != null) {
        console.log("ID====>" + id)
    }
    $("#id").val(id);
    //初始化
    $.ajax({
        url: "/admin/article/queryOne?id=" + id,
        type: "get",
        success: function (resp) {
            var data = resp.data;
            he.set(data.content);
            $("#title").val(data.title)
            $("#category").val(data.category)
            $("#firstImg").val(data.firstImg)
            $("#description").val(data.description)
        }
    })


    //获取url中的参数
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return encodeURI(r[2]);
        return null; //返回参数值
    }


    //修改监听
    $("#publish").click(function () {
        //异步把数据同步到textare
        he.sync()
        console.log($("form").serializeObject());
        $.ajax({
            url: "/admin/article/update",
            data: JSON.stringify($("form").serializeObject()),
            type: "PUT",
            contentType: "application/json;charset=UTF-8",
            success: function (resp) {
                if (resp.code == 200) {
                    Message.success(resp.msg)
                    window.open("articleManagement.html", "_self")
                } else {
                    Message.error(resp.msg)
                }
            },
            error: function () {
                Message.error("发布失败，找不到服务器。")
            }
        })
    })

    /**
     * 自动将form表单封装成json对象
     */
    $.fn.serializeObject = function () {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function () {
            if (o[this.name]) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    $("#logout").click(function () {
        $.ajax({
            url: "/user/logout",
            type: "get",
            success: function (resp) {
                Message.success(resp.msg)
                window.open("/login.html", "_self");
            }
        })
    })

</script>


</html>
